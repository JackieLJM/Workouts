/*
 * jTeaser jquery plugin
 *
 * Author : Philippe Jean
 * File : jQuery.jTeaser.js
 * Date : 1 Mai 2010 / 1 May 2010
 * Update : 25 décembre 2010 / 25 december 2010
 * Version 1.0.0
 *
 * Requires jQuery v1.4.2
 *
 * Ever eared about the expression kiss (keep it simple and sweet). jTeaser aims
 * to be a dummy proof Html viewer wich eliviate css programming. jTeaser aims
 * to be a plug and play viewer. Just insert the right html Markup, configure
 * color, font, and other settings using options, and that it's.
 *
 */
(function(a){a.fn.jTeaser=function(A){var S=a.extend(true,{debug:false,mode:"display",orientation:"horizontal",teasers:null,layout:{nbButtons:4,buttonWidth:150,buttonHeight:63,imageWidth:350},loop:"once",loopPause:5000,showText:true,intro:true,message:null,style:{border:"1px solid silver",separatorColor:"#FFFFFF",buttons:{background:"#F7F3EC",title:{fontFamily:"Arial, Verdana, Helvetica",fontSize:"11px",lineHeight:"12px",fontWeight:"bold",color:"#997755"},text:{fontFamily:"Arial, Verdana, Helvetica",fontSize:"9px",lineHeight:"10px",color:"#997755"}},magnifier:{background:"#F7F3EC",title:{fontFamily:"Arial, Verdana, Helvetica",fontSize:"11px",lineHeight:"12px",fontWeight:"bold",color:"#997755"},text:{fontFamily:"Arial, Verdana, Helvetica",fontSize:"9px",lineHeight:"10px",color:"#997755"}}}},A);var B=S.debug;var i=2;var o=-1;var e=false;var I=a(this),q=null,J=null,s=null;var P={$url:null,$image:null,$image_view:null};var h={$viewport:null,$slider:null,currentIndex:0};var j=S.mode;var T=S.teasers;var w=null;var x=0;var Q=0;var W=0;var u=0;var t=0;var L=5;var m=0.5;var c=0;var f=0;var V=0;var H=0;var F=S.intro;var b="_self";k();return this;function E(X){return a("<"+X+">")}function v(X){return(typeof X==="undefined")}function M(X){return(X===null)}function O(X,Y){return(Y in X)}function K(){if(B){y("Calculating dimensions...")}x=S.layout.buttonWidth;Q=S.layout.buttonHeight;W=S.layout.nbButtons;u=x+50;t=Q;c=S.layout.imageWidth+x;f=M(w)?((W*Q)-1):(W*Q);V=S.layout.imageWidth;H=f;if(B){y("Component width: "+c);y("Component height: "+f);y("Image width: "+V);y("Image height: "+H);y("Button width: "+x);y("Button height: "+Q);y("magnifier width: "+u);y("magnifier height: "+t);y("paddings: "+M(w)?L:0);y("Border height: "+M(w)?(m*2):0)}}function r(){if(B){y("Sniffing up the HTML markup data...")}var Y=I.find("#teasers").detach();if(v(Y)||M(Y)){if(B){y("There is no teasers markup data !")}return null}var X=Y.children("div[id^='teaser']");var Z=Y.children("div[id^='magnifier']");if(v(X)||M(X)||!O(X,"length")||X.length<W){return null}if(v(Z)||M(Z)||!O(Z,"length")||Z.length<W){return null}if(X.length!=Z.length){if(B){y("Mismatch between button count and teaser count !")}return null}return{buttons:X,magnifiers:Z}}function n(X){if(B){y("Getting HTML markup data for element "+X)}if(X>=w.buttons.lenght){return null}if(X>=w.magnifiers.lenght){return null}return{button:w.buttons[X],magnifier:w.magnifiers[X]};return null}function D(aa,Y,Z){var X=E("div").attr({id:aa});if(M(Z)){X.append(E("div").attr({id:"title"}).css({padding:"0px",margin:"0px"}));if(Y){X.append(E("div").attr({id:"text"}).css({padding:"0px",margin:"0px"}))}}return X}function d(X){return E("div").attr({id:X}).append(E("a").attr({id:"url",href:"#",target:b}).append(E("img").attr({id:"image_view",src:"#",border:0,alt:""})))}function R(){var Z=E("div").attr({id:"viewport"});var Y=E("div").attr({id:"slider"});for(var X=0;X<W;X++){Y.append(d("image-"+X))}Z.append(Y);return Z}function p(Z){Z.$viewport.css({display:"block",width:V+"px",height:H+"px",left:"0px",top:"0px",position:"relative",padding:"0px",margin:"0px",overflow:"hidden"});Z.$slider.css({width:(V*W)+"px",height:H+"px",left:0+"px",top:0+"px",padding:"0px",margin:"0px",display:"block",position:"absolute",overflow:"hidden"});var aa={display:"block",width:V+"px",height:H+"px",left:"0px",top:"0px",position:"absolute",padding:"0px",margin:"0px",overflow:"hidden",zIndex:10};for(var Y=0;Y<W;Y++){var ab;var X=Z.$slider.find("#image-"+Y);X.css(aa);X.css({left:(Y*V)+"px"});if(M(w)){ab=T[Y];X.find("#url").attr("href",ab.url);X.find("#image_view").attr({src:ab.image,width:V,height:H,border:"0px"})}else{ab=n(Y);X.find("#url").attr("href",a(ab.button).attr("data-url"));X.find("#image_view").attr({src:a(ab.button).attr("data-image"),width:V,height:H,border:"0px"})}}}function U(X,Z){if(B){y("Creating jTeaser HTML markup...")}if(j=="display"){I.append(d("image"))}else{if(j=="slide"){I.append(R())}}for(var Y=0;Y<W;Y++){I.append(D("button"+(Y+1),X,Z))}I.append(D("magnifier",X,Z));if(j=="display"){return{$image:I.find("#image"),$image_view:I.find("#image").find("#image_view"),$url:I.find("#image").find("#url")}}else{if(j=="slide"){return{$viewport:I.find("#viewport"),$slider:I.find("#viewport").find("#slider")}}}return null}function k(){if(B){y("Initializing jTeaser...")}if(v(T)||M(T)||!a.isArray(T)){w=r();if(!M(w)){L=0;m=0}}K();if(M(T)&&M(w)){if(B){y("There is no teasers data (options) and no HTML markup data")}}var Z=U(S.showText,w);I.css({position:"relative",display:"block",width:c+"px",height:f+"px",overflow:"hidden",border:S.style.border});if(j=="display"){P=a.extend(true,P,Z);P.$image.css({position:"absolute",display:"block",top:"0px",left:"0px",width:V+"px",height:H+"px",zIndex:"10",overflow:"hidden",padding:"0px",margin:"0px"});P.$image_view.attr({width:V,height:H}).css({padding:"0px",margin:"0px",border:"0px"});P.$url.css({padding:"0px",margin:"0px",border:"0px"})}else{if(j=="slide"){p(h=a.extend(true,h,Z))}}s=I.children("div[id^='button']");var X={background:S.style.buttons.background,margin:"0px 0px",padding:L+"px",position:"absolute",width:(x-(L*2))+"px",height:(Q-(L*2)-(m*2))+"px",left:V+"px",zIndex:"10",cursor:"pointer",textAlign:"left",overflow:"hidden"};if(!a.isArray(S.style.buttons)){s.each(function(aa){var ac=a(this);ac.css(X);ac.css({top:(Q*aa)+"px"});if(M(w)){ac.css({borderBottom:"1px solid "+S.style.separatorColor});ac.children("#title").css(S.style.buttons.title);if(S.showText){ac.children("#text").css(S.style.buttons.text);ac.children("#separation").css({margin:"0px 0px 5px 0px"})}ac.children("#title").html(T[aa].title);if(S.showText){ac.children("#text").html(T[aa].text)}}else{var ab=n(aa);ac.append(ab.button)}ac.click(function(){function ad(){o=window.setInterval(g,S.loopPause)}if(S.loop=="infinite"){clearInterval(o)}G(aa+1);if(S.loop=="infinite"){window.setTimeout(ad,10000)}})})}q=I.find("#magnifier");J=I.find("#magnifier-container");q.css({background:S.style.magnifier.background,position:"absolute",top:"0px",width:(u-(L*2))+"px",height:(t-(L*2)-(m*2))+"px",left:(c-u)+"px",margin:"0px 0px",padding:L+"px",zIndex:"15",visibility:"hidden",display:"none",cursor:"pointer",textAlign:"left",overflow:"hidden"});if(M(w)){q.find("#title").css(S.style.magnifier.title);if(S.showText){q.find("#text").css(S.style.magnifier.text)}}else{var Y=n(1);q.empty();if(!a.browser.msie){q.append(Y.magnifier)}else{q.append(a(Y.magnifier).clone())}}q.click(function(){if(j=="display"){window.open(P.$url.attr("href"),P.$url.attr("target"))}else{var aa=(h.$slider.find("#image-"+h.currentIndex)).find("#url");window.open(aa.attr("href"),aa.attr("target"))}});if(F){l(function(){G(1)})}else{G(1)}if((S.loop=="once")||(S.loop=="infinite")){o=window.setInterval(g,S.loopPause)}if(!M(S.message)){C(1750,10000)}}function l(X){q.css({top:"0px",left:"-"+u+"px",display:"block",visibility:"visible",opacity:0.25});z(1);N(1);q.animate({left:"+="+(u+(c-u))+"px",opacity:1},2500,"swing",X)}function z(X){var Y=X-1;q.css({visibility:"visible",display:"block"});if(M(w)){q.find("#title").text(T[Y].title);if((S.showText)&&(!v(T[Y].textMagnifier))){q.find("#text").text(T[Y].textMagnifier)}else{if(S.showText){q.find("#text").text(T[Y].text)}}}else{var Z=n(Y);q.empty();if(!a.browser.msie){q.append(Z.magnifier)}else{q.append(a(Z.magnifier).clone())}}}function N(X){var Y=X-1;if(j=="display"){P.$image_view.fadeOut("fast",function(){if(M(w)){P.$image_view.attr("src",T[Y].image);P.$image_view.fadeIn("fast")}else{var aa=n(Y);P.$image_view.attr("src",a(aa.button).attr("data-image"));P.$image_view.fadeIn()}});if(M(w)){P.$url.attr("href",T[Y].url)}else{var Z=n(Y);P.$url.attr("href",a(Z.button).attr("data-url"))}}else{if(j=="slide"){h.$slider.animate({left:"-"+(Y*V)+"px"},S.speed,"linear",function(){});h.currentIndex=Y}}}function G(X){var Y=X-1;q.animate({top:(Q*Y)+"px"},"slow","linear",function(){z(X);N(X)})}function C(ab,Z){var Y=I.find("#message");var X=(Y.length==0)?E("div"):Y;var aa=5;X.css({display:"block",visibility:"visible",width:(V-(aa*2))+"px",height:(30-(aa*2))+"px",left:"0px",top:f+"px",position:"absolute",padding:aa+"px",margin:"0px",overflow:"hidden",zIndex:12,backgroundColor:"#000000",color:"#FFFFFF",fontFamily:"Arial",fontWeight:"bold",fontSize:"10px",lineHeight:"10px",filter:"alpha(opacity=50)","-moz-opacity":"0.5","-khtml-opacity":"0.5",opacity:"0.5"}).attr({id:"message"});X.text(S.message);if(Y.length==0){I.append(X)}X.animate({top:"-="+30+"px"},ab,"linear").delay(Z).animate({top:"+="+30+"px"},2500,"linear")}function g(){if(i<=W){G(i++);e=true}else{i=1;G(i++);if(S.loop=="once"){clearInterval(o)}e=false}}function y(X){if(window.console&&window.console.log){window.console.log(X)}}};a.fn.jTeaser.defaults={debug:false,mode:"display",orientation:"horizontal",teasers:null,layout:{nbButtons:4,buttonWidth:150,buttonHeight:63,imageWidth:350},loop:"once",loopPause:5000,showText:true,intro:true,message:null,style:{border:"1px solid silver",separatorColor:"#FFFFFF",buttons:{background:"#F7F3EC",title:{fontFamily:"Arial, Verdana, Helvetica",fontSize:"11px",lineHeight:"12px",fontWeight:"bold",color:"#997755"},text:{fontFamily:"Arial, Verdana, Helvetica",fontSize:"9px",lineHeight:"10px",color:"#997755"}},magnifier:{background:"#F7F3EC",title:{fontFamily:"Arial, Verdana, Helvetica",fontSize:"11px",lineHeight:"12px",fontWeight:"bold",color:"#997755"},text:{fontFamily:"Arial, Verdana, Helvetica",fontSize:"9px",lineHeight:"10px",color:"#997755"}}}}})(jQuery);